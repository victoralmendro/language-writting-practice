<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writting Practice - Random Word Picker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            max-width: 100%;
            overflow: auto;
        }

        #table-words{
            border-collapse: collapse;
        }

        .table-words-word{
            display: block;
            border-bottom: 1px;
            border-bottom-color: black;
            border-bottom-style: solid;
            padding: 5px;
        }

        .table-words-item{
            text-align: center;
            border: 1px solid black;
            padding: 0;
            margin: 0;
        }

        .table-words-button-container{
            display: flex;
        }

        .table-words-button{
            border-right: 1px;
            border-right-color: black;
            border-right-style: solid;
            background-color: #666666;
            flex: 1;
        }
        .table-words-button:hover{
            background-color: #333333;
        }

        .table-words-button:last-child{
            border-right: none;
        }

        #words-simple{
            margin-bottom: 15px;
            display: block;
        }
    </style>
    <script src="config.js"></script>
    <script>
        function processVersion(currentVersion){
            try {
                const intCurrentVersion = parseInt(currentVersion);
                let intStoredVersion = 0;

                const storedVersion = localStorage.getItem("version");

                if(storedVersion){
                    intStoredVersion = parseInt(storedVersion);
                }

                if(storedVersion < currentVersion){
                    //migration here
                }

                localStorage.setItem("version", currentVersion);
            } catch (error) {
                console.error("Failed to update version", error);
            }
        }

        processVersion(CONFIG.version);
    </script>
</head>
<body>
    <h1> Practice your writting with the Random Word Picker</h1>
    
    <label for="numWords">How many words do you want to pick?</label>
    <input type="number" id="numWords" name="numWords" min="1" value="3">
    <button id="pickWordsBtn">Pick Words</button>
    
    <div class="result" id="resultArea">
        <span id="words-simple"></span>
        <table id="table-words">
            <!-- <tr>
                <td class="table-words-item">
                    <span class="table-words-word">word_to_use</span>
                    <div class="table-words-button-container">
                        <button class="table-words-button">push</button>
                        <button class="table-words-button">change</button>
                        <button class="table-words-button">forget</button>
                    </div>
                </td>
            </tr> -->
        </table>
    </div>

    <script>
        let data = CONFIG.learn;
        storeWords(data);

        let lastResult = [];

        for (let index = 0; index < Object.keys(data).length/2; index++) {
            data = shuffleArray(data);
        }
        
        let remainingWords = [...data];

        function storeWords(arrWords){
            for (let index = 0; index < arrWords.length; index++) {
                const word = arrWords[index];

                const savedItem = localStorage.getItem(word);

                if(savedItem){
                    continue;
                }

                localStorage.setItem(word, "{}");
            }
        }

        function pickWords(numWords, allWords) {
            const result = [];

            // Ensure that the number of requested words does not exceed the available total
            numWords = Math.min(numWords, remainingWords.length);

            let pickedWords = [];

            // Pick more words from previously used categories, if necessary
            for (let i = 0; i < numWords; i++) {
                const word = pickWordFromList(remainingWords);
                result.push(word);
                remainingWords = removeWord(remainingWords, word);
            }

            return result;
        }

        function pickWordFromList(list) {
            const randomIndex = Math.floor(Math.random() * list.length);
            return list[randomIndex];
        }

        function removeWord(list, word) {
            return list.filter(item => item !== word);
        }

        function updateUI(arrResult) {
            fillElemWordsSimple(arrResult);
            fillElemWordsTable(arrResult);
        }

        function push(index, word){
            console.log(`push: ${word}`);
        }

        function change(index, word){
            const newWord = pickWords(1, remainingWords);

            lastResult[index] = newWord;

            updateUI(lastResult);
        }

        function forget(index, word){
            console.log(`forget: ${word}`);
        }

        function fillElemWordsTable(arrResult){
            const docFragment = document.createDocumentFragment();

            const tr = document.createElement("tr");

            for (let index = 0; index < arrResult.length; index++) {
                const word = arrResult[index];
                
                const tdWordsItem = document.createElement("td");
                tdWordsItem.classList.add("table-words-item");

                tr.appendChild(tdWordsItem);

                const spanWord = document.createElement("span");
                spanWord.classList.add("table-words-word");
                spanWord.innerText = word;

                tdWordsItem.appendChild(spanWord);

                const divBtnContainer = document.createElement("div");
                divBtnContainer.classList.add("table-words-button-container");
                
                tdWordsItem.appendChild(divBtnContainer);
                
                const btnPush = document.createElement("button");
                btnPush.type = "button";
                btnPush.innerText = "push";
                btnPush.classList.add("table-words-button");
                btnPush.onclick = ()=>{push(index, word)};

                const btnChange = document.createElement("button");
                btnChange.type = "button";
                btnChange.innerText = "change";
                btnChange.classList.add("table-words-button");
                btnChange.onclick = ()=>{change(index, word)};

                const btnForget = document.createElement("button");
                btnForget.type = "button";
                btnForget.classList.add("table-words-button");
                btnForget.innerText = "forget";
                btnForget.onclick = ()=>{forget(index, word)};

                divBtnContainer.appendChild(btnPush);
                divBtnContainer.appendChild(btnChange);
                divBtnContainer.appendChild(btnForget);

            }

            docFragment.appendChild(tr);

            const tableWords = document.getElementById("table-words");
            tableWords.innerHTML = "";
            tableWords.appendChild(docFragment);
        }

        function fillElemWordsSimple(arrResult){
            const elemWordsSimples = document.getElementById('words-simple');

            if (arrResult.length === 0) {
                elemWordsSimples.innerText = "There are no more words to pick!";
            } else {
                elemWordsSimples.innerText = arrResult.toString().replaceAll(",", "; ");
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1)); // Random index from 0 to i
                [array[i], array[j]] = [array[j], array[i]];  // Swap elements
            }
            return array;
        }

        document.getElementById('pickWordsBtn').addEventListener('click', () => {
            const numWords = parseInt(document.getElementById('numWords').value);

            const result = pickWords(numWords, data);
            lastResult = result;

            updateUI(result);
        });
    </script>
</body>
</html>
